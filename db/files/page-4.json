{
  "title": "lang::report_4_title::local_kopere_bi",
  "description": "lang::report_4_description::local_kopere_bi",
  "refkey": "statistics",
  "category": {
    "refkey": "enrollments",
    "title": "lang::report_4_cat_title::local_kopere_bi",
    "sortorder": 7,
    "description": "lang::report_4_cat_description::local_kopere_bi"
  },
  "blocks": [
    {
      "refkey": "enrollments-2",
      "type": "block-1",
      "sequence": 2,
      "elements": [
        {
          "pre_requisit": "mysql",
          "title": "lang::report_4_coursesenrollmentstatus::local_kopere_bi",
          "refkey": "report_4_coursesenrollmentstatus",
          "block_num": 1,
          "type": "table",
          "theme": "light",
          "css": "",
          "html_before": "",
          "html_after": "",
          "commandsql": "SELECT \n    u.id AS u_id,\n    u.firstname,\n    u.lastname,\n    u.email,\n    u.city,\n    u.country,\n    c.id       AS c_id,\n    c.fullname AS c_fullname,\n    cm.id      AS cm_cmid,\n    m.name AS module_name,\n    ROUND(\n        CASE\n            WHEN g.rawgrademax > 0 THEN (g.finalgrade \/ g.rawgrademax) * 100\n            ELSE g.finalgrade\n        END, 0\n    ) AS grade,\n    CASE\n        WHEN cmc.completionstate = 0 THEN 'lang::report_4_completionstate_0::local_kopere_bi'\n        WHEN cmc.completionstate = 1 THEN 'lang::report_4_completionstate_1::local_kopere_bi'\n        WHEN cmc.completionstate = 2 THEN 'lang::report_4_completionstate_2::local_kopere_bi'\n        WHEN cmc.completionstate = 3 THEN 'lang::report_4_completionstate_3::local_kopere_bi'\n        WHEN cmc.completionstate = 4 THEN 'lang::report_4_completionstate_4::local_kopere_bi'\n        ELSE 'lang::report_4_completionstate_none::local_kopere_bi'\n    END AS completionstate_status,\n    CASE\n        WHEN cm.completion = 0 THEN 'lang::report_4_completion_0::local_kopere_bi'\n        WHEN cm.completion = 1 THEN 'lang::report_4_completion_1::local_kopere_bi'\n        WHEN cm.completion = 2 THEN 'lang::report_4_completion_2::local_kopere_bi'\n        ELSE 'lang::report_4_completion_none::local_kopere_bi'\n    END AS completion_status,\n    ue.enrol_status AS enrol_status,\n    ue.timeend       AS enrol_timeend\nFROM (\n    SELECT MIN(ue1.id) AS id, \n           ue1.userid, \n           e1.courseid, \n           MIN(ue1.status) AS enrol_status, \n           MIN(ue1.timeend) AS timeend\n    FROM mdl_user_enrolments ue1\n    JOIN mdl_enrol e1 ON e1.id = ue1.enrolid\n    GROUP BY ue1.userid, e1.courseid\n) ue\nJOIN mdl_user u \n         ON u.id = ue.userid\nJOIN mdl_course c \n         ON c.id = ue.courseid\nJOIN mdl_course_modules cm \n         ON cm.course = c.id\n        AND cm.instance > 0\nJOIN mdl_modules m \n         ON m.id = cm.module\nLEFT JOIN mdl_grade_items gi \n         ON gi.itemtype = 'mod'\n        AND gi.iteminstance = cm.instance\n        AND gi.itemmodule = m.name\n        AND gi.gradetype = 1\nLEFT JOIN mdl_grade_grades g \n         ON g.itemid = gi.id\n        AND g.userid = u.id\nLEFT JOIN mdl_course_modules_completion cmc \n         ON cmc.coursemoduleid = cm.id\n        AND cmc.userid = u.id\n\nWHERE c.id = :courseid\n  AND u.deleted = 0\n  AND u.suspended = 0\n  AND c.visible = 1\n  AND cm.visible = 1",
          "cache": "30m",
          "reload": "30m",
          "info": "{\n    \"column\": {\n        \"u_id\": {\n            \"key\": \"u_id\",\n            \"title\": \"#\",\n            \"type\": \"userphotoRenderer\",\n            \"mustache\": \"<a href=\\\"{{{config.wwwroot}}}\\\/user\\\/view.php?id={{{u_id}}}\\\"\\r\\n   target=\\\"profile\\\">{{{u_fullname}}}<\\\/a>\"\n        },\n        \"firstname\": {\n            \"key\": \"firstname\",\n            \"title\": \"lang::u_fullname::local_kopere_bi\",\n            \"type\": \"userfullname\",\n            \"mustache\": \"<a href=\\\"{{{config.wwwroot}}}\\\/user\\\/view.php?id={{{u_id}}}\\\"\\r\\n   target=\\\"profile\\\">{{{u_fullname}}}<\\\/a>\"\n        },\n        \"lastname\": {\n            \"key\": \"lastname\",\n            \"title\": \"\",\n            \"type\": \"none\",\n            \"mustache\": \"\"\n        },\n        \"email\": {\n            \"key\": \"email\",\n            \"title\": \"lang::email::moodle\",\n            \"type\": \"string\",\n            \"mustache\": \"<a href=\\\"mailto:{{{email}}}\\\" target=\\\"_blank\\\">{{{email}}}<\\\/a>\"\n        },\n        \"city\": {\n            \"key\": \"city\",\n            \"title\": \"lang::city_name::local_kopere_bi\",\n            \"type\": \"none\",\n            \"mustache\": \"\"\n        },\n        \"country\": {\n            \"key\": \"country\",\n            \"title\": \"lang::country_name::local_kopere_bi\",\n            \"type\": \"none\",\n            \"mustache\": \"\"\n        },\n        \"c_id\": {\n            \"key\": \"c_id\",\n            \"title\": \"c_id\",\n            \"type\": \"none\",\n            \"mustache\": \"\"\n        },\n        \"c_fullname\": {\n            \"key\": \"c_fullname\",\n            \"title\": \"lang::c_fullname::local_kopere_bi\",\n            \"type\": \"string\",\n            \"mustache\": \"<a href=\\\"{{{config.wwwroot}}}\\\/course\\\/view.php?id={{{c_id}}}\\\"\\r\\n   target=\\\"course\\\">{{{c_fullname}}}<\\\/a>\"\n        },\n        \"cm_cmid\": {\n            \"key\": \"cm_cmid\",\n            \"title\": \"cm_cmid\",\n            \"type\": \"none\",\n            \"mustache\": \"{{{cm_cmid}}}\"\n        },\n        \"module_name\": {\n            \"key\": \"module_name\",\n            \"title\": \"lang::module_name::local_kopere_bi\",\n            \"type\": \"string\",\n            \"mustache\": \"<a href=\\\"{{{config.wwwroot}}}\\\/mod\\\/{{{module_name}}}\\\/view.php?id={{{cm_cmid}}}\\\">\\r\\n    {{#str}} modulename,{{{module_name}}} {{\\\/str}}\\r\\n<\\\/a>\"\n        },\n        \"grade\": {\n            \"key\": \"grade\",\n            \"title\": \"lang::grade::local_kopere_bi\",\n            \"type\": \"number\",\n            \"mustache\": \"\"\n        },\n        \"completionstate_status\": {\n            \"key\": \"completionstate_status\",\n            \"title\": \"lang::completionstate_status::local_kopere_bi\",\n            \"type\": \"translate\",\n            \"mustache\": \"\"\n        },\n        \"completion_status\": {\n            \"key\": \"completion_status\",\n            \"title\": \"lang::completion_status::local_kopere_bi\",\n            \"type\": \"translate\",\n            \"mustache\": \"\"\n        },\n        \"enrol_status\": {\n            \"key\": \"enrol_status\",\n            \"title\": \"lang::enrol_status::local_kopere_bi\",\n            \"type\": \"statusRenderer\",\n            \"mustache\": \"<span class=\\\"w-100 badge {{^enrol_status}}bg-success{{\\\/enrol_status}}{{#enrol_status}}bg-danger{{\\\/enrol_status}}\\\">\\r\\n    {{#enrol_status}} {{#str}} inactive,moodle {{\\\/str}} {{\\\/enrol_status}}\\r\\n    {{^enrol_status}} {{#str}}   active,moodle {{\\\/str}} {{\\\/enrol_status}}\\r\\n<\\\/span>\"\n        },\n        \"enrol_timeend\": {\n            \"key\": \"enrol_timeend\",\n            \"title\": \"lang::enrol_timeend::local_kopere_bi\",\n            \"type\": \"dateRenderer\",\n            \"mustache\": \"\"\n        }\n    }\n}"
        }
      ]
    },
    {
      "refkey": "enrollments-1",
      "type": "block-1",
      "sequence": 1,
      "elements": [
        {
          "title": "lang::report_4_enrolpercourse::local_kopere_bi",
          "refkey": "report_4_enrolpercourse",
          "block_num": 1,
          "type": "area",
          "theme": "light",
          "css": "",
          "html_before": null,
          "html_after": null,
          "commandsql": "SELECT c.fullname,\n       SUM(CASE \n               WHEN ue.status = 0 AND (ue.timeend = 0 OR ue.timeend > UNIX_TIMESTAMP()) THEN 1\n               ELSE 0\n           END) AS 'lang::active_enrolments::local_kopere_bi',\n       SUM(CASE \n               WHEN ue.status = 1 THEN 1\n               ELSE 0\n           END) AS 'lang::inactive_enrolments::local_kopere_bi',\n       SUM(CASE \n               WHEN ue.status = 0 AND ue.timeend > 0 AND ue.timeend < UNIX_TIMESTAMP() THEN 1\n               ELSE 0\n           END) AS 'lang::expired_enrolments::local_kopere_bi'\nFROM mdl_course c\nJOIN mdl_enrol e ON e.courseid = c.id\nJOIN mdl_user_enrolments ue ON ue.enrolid = e.id\nGROUP BY c.id\nORDER BY c.fullname",
          "cache": "30m",
          "reload": "30m",
          "info": "{\n    \"chart_options\": \"{\\r\\n    stroke : {\\r\\n        colors : [\\\"#2E93fA\\\", \\\"#66DA26\\\", \\\"#546E7A\\\", \\\"#E91E63\\\", \\\"#FF9800\\\"]\\r\\n    },\\r\\n    yaxis : {\\r\\n        labels : {\\r\\n            formatter: (value) => { return value },\\r\\n        },\\r\\n    },\\r\\n}\"\n}"
        }
      ]
    }
  ]
}
