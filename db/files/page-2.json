{
  "title": "lang::report_1_title::local_kopere_bi",
  "description": "lang::report_1_description::local_kopere_bi",
  "user_id": null,
  "refkey": "active_students",
  "pre_requisit": "mysql",
  "category": {
    "refkey": "students",
    "title": "lang::report_1_cat_title::local_kopere_bi",
    "description": "lang::report_1_cat_description::local_kopere_bi"
  },
  "blocks": [
    {
      "refkey": "students-1",
      "type": "block-1",
      "sequence": 1,
      "elements": [
        {
          "title": "lang::report_1_user_summary::local_kopere_bi",
          "refkey": "report_1_user_summary",
          "block_num": 1,
          "type": "table",
          "theme": "light",
          "css": "",
          "html_before": null,
          "html_after": null,
          "commandsql": "SELECT \n    u.id AS u_id,\n    u.firstname,\n    u.lastname,\n    c.id AS c_id,\n    c.fullname AS c_fullname,\n    u.email,\n    u.lastaccess,\n    u.timecreated,\n    ROUND(\n        AVG(\n            CASE\n                WHEN g.rawgrademax > 0\n                THEN (g.finalgrade \/ g.rawgrademax) * 100\n                ELSE g.finalgrade \n            END\n        ), 0\n    ) AS g_finalgrade,\n    MAX(ca.completed_activities) AS ca_completed_activities\nFROM \n    mdl_course c\nJOIN \n    mdl_context ctx ON ctx.instanceid = c.id\nJOIN \n    mdl_role_assignments ra ON ra.contextid = ctx.id\n                            AND ra.roleid = 5\nJOIN \n    mdl_user u ON u.id = ra.userid\nLEFT JOIN (\n        SELECT \n            COUNT(id) AS completed_activities, \n            userid\n        FROM \n            mdl_course_modules_completion\n        WHERE \n            id > 1\n            AND completionstate IN (1, 2)\n        GROUP BY \n            userid\n    ) ca ON ca.userid = u.id\nLEFT JOIN \n    mdl_grade_items gi ON gi.courseid = c.id \n                       AND gi.itemtype = 'course'\nLEFT JOIN \n    mdl_grade_grades g ON g.itemid = gi.id \n                      AND g.userid = u.id \n                      AND g.finalgrade IS NOT NULL\nWHERE u.id        > 1\n  AND u.deleted   = 0\n  AND u.suspended = 0\n  AND u.username != 'guest'\nGROUP BY u.id",
          "cache": "30m",
          "reload": "30m",
          "info": "{\"column\":{\"u_id\":{\"key\":\"u_id\",\"title\":\"#\",\"type\":\"none\",\"mustache\":\"\"},\"firstname\":{\"key\":\"firstname\",\"title\":\"lang::u_fullname::local_kopere_bi\",\"type\":\"userfullname\",\"mustache\":\"<a href=\\\"{{{config.wwwroot}}}\\\/user\\\/view.php?id={{{u_id}}}\\\"\\r\\n   target=\\\"profile\\\">{{{u_fullname}}}<\\\/a>\"},\"lastname\":{\"key\":\"lastname\",\"title\":\"lang::lastname::moodle\",\"type\":\"none\",\"mustache\":\"\"},\"c_id\":{\"key\":\"c_id\",\"title\":\"c_id\",\"type\":\"none\",\"mustache\":\"\"},\"c_fullname\":{\"key\":\"c_fullname\",\"title\":\"lang::c_fullname::local_kopere_bi\",\"type\":\"string\",\"mustache\":\"<a href=\\\"{{{config.wwwroot}}}\\\/course\\\/view.php?id={{{c_id}}}\\\"\\r\\n   target=\\\"course\\\">{{{c_fullname}}}<\\\/a>\"},\"email\":{\"key\":\"email\",\"title\":\"lang::email::moodle\",\"type\":\"string\",\"mustache\":\"<a href=\\\"mailto:{{{email}}}\\\" target=\\\"_blank\\\">{{{email}}}<\\\/a>\"},\"lastaccess\":{\"key\":\"lastaccess\",\"title\":\"lang::lastaccess::moodle\",\"type\":\"datetimeRenderer\",\"mustache\":\"\"},\"timecreated\":{\"key\":\"timecreated\",\"title\":\"lang::timecreated::moodle\",\"type\":\"datetimeRenderer\",\"mustache\":\"\"},\"g_finalgrade\":{\"key\":\"g_finalgrade\",\"title\":\"lang::g_finalgrade::local_kopere_bi\",\"type\":\"number\",\"mustache\":\"\"},\"ca_completed_activities\":{\"key\":\"ca_completed_activities\",\"title\":\"lang::ca_completed_activities::local_kopere_bi\",\"type\":\"number\",\"mustache\":\"\"}}}"
        }
      ]
    }
  ]
}
